# 🎯 포인트 시스템 백로그

## 📋 개요

FeedShop의 포인트 시스템 구현을 위한 기능 요구사항 및 백로그입니다.

---

## 🎯 MYCE-232: 포인트 잔액 및 거래 내역 조회 기능

### User Story

**As a** 포인트를 활용하려는 사용자  
**I want to** 현재 보유한 포인트 잔액과 적립/사용 내역을 한눈에 볼 수 있도록  
**So that** 포인트를 효과적으로 관리하고 사용할 수 있다.

### Description

사용자의 포인트 잔액과 적립 및 사용 내역을 조회하는 API를 구현한다.

### Acceptance Criteria (완료 조건)

- [x] `GET /api/users/points/balance` 엔드포인트 호출 시 사용자의 포인트 정보를 반환한다.
- [x] 반환되는 포인트 정보에 현재 잔액, 총 적립/사용/만료 포인트가 포함된다.
- [x] `GET /api/users/points/transactions` 엔드포인트로 거래 내역을 조회할 수 있다.
- [x] 인증되지 않은 사용자 접근 시 401 Unauthorized 응답을 반환한다.
- [x] 단위 테스트(Unit) 완료
- [x] 프론트 연동(동작) 테스트 준비
- [x] SonarCube(cloud) 테스트 통과

### 구현을 위한 기술 Task (To-Do)

- [x] 포인트 데이터베이스 스키마 설계 및 구현 (UserPoint, PointTransaction 테이블)
- [x] 포인트 잔액 계산 로직 구현
- [x] 포인트 내역 조회 로직 구현 (최신순 정렬, 페이징)
- [x] API 문서화 및 테스트

---

## 🎯 MYCE-233: 포인트 적립 및 사용 기능

### User Story

**As a** 쇼핑몰 사용자  
**I want to** 주문 시 포인트를 사용하고 주문 완료 후 포인트를 적립받을 수 있도록  
**So that** 할인 혜택을 받고 다음 구매에 활용할 수 있다.

### Description

주문 시 포인트 사용 및 주문 완료 후 포인트 적립 기능을 구현한다.

### Acceptance Criteria (완료 조건)

- [x] 주문 시 보유 포인트 범위 내에서 포인트 사용이 가능하다.
- [x] 포인트는 100포인트 단위로만 사용 가능하다.
- [x] 주문 완료 시 주문 금액의 0.5% 포인트가 자동 적립된다.
- [x] 포인트 사용/적립 시 거래 내역이 기록된다.
- [x] 포인트 부족 시 적절한 에러 메시지를 반환한다.
- [x] 단위 테스트(Unit) 완료
- [x] 프론트 연동(동작) 테스트 준비
- [x] SonarCube(cloud) 테스트 통과

### 구현을 위한 기술 Task (To-Do)

- [x] 포인트 사용 로직 구현 (usePoints)
- [x] 포인트 적립 로직 구현 (earnPoints)
- [x] OrderCommonService와 포인트 시스템 연동
- [x] 포인트 사용 가능 여부 검증 로직
- [x] 포인트 거래 내역 생성 로직

---

## 🎯 MYCE-234: 포인트 거래 내역 상세 조회 기능

### User Story

**As a** 포인트 사용자  
**I want to** 다양한 조건으로 포인트 거래 내역을 조회할 수 있도록  
**So that** 포인트 사용 패턴을 분석하고 효율적으로 관리할 수 있다.

### Description

타입별, 기간별, 주문별 포인트 거래 내역 조회 기능을 구현한다.

### Acceptance Criteria (완료 조건)

- [x] `GET /api/users/points/transactions/type/{type}` 엔드포인트로 타입별 조회가 가능하다.
- [x] `GET /api/users/points/transactions/period` 엔드포인트로 기간별 조회가 가능하다.
- [x] `GET /api/users/points/transactions/order/{orderId}` 엔드포인트로 주문별 조회가 가능하다.
- [x] 페이징 처리가 적용되어 대용량 데이터를 효율적으로 처리한다.
- [x] 거래 내역은 최신순으로 정렬된다.
- [x] 단위 테스트(Unit) 완료
- [x] 프론트 연동(동작) 테스트 준비
- [x] SonarCube(cloud) 테스트 통과

### 구현을 위한 기술 Task (To-Do)

- [x] PointTransactionRepository에 다양한 조회 쿼리 구현
- [x] 페이징 처리 로직 구현
- [x] 타입별, 기간별, 주문별 조회 API 구현
- [x] API 응답 DTO 설계 및 구현

---

## 🎯 MYCE-235: 포인트 만료 관리 시스템

### User Story

**As a** 포인트 시스템 관리자  
**I want to** 만료된 포인트를 자동으로 처리하고 사용자에게 만료 예정 포인트를 알려주도록  
**So that** 포인트 정책을 일관되게 적용하고 사용자 경험을 향상시킬 수 있다.

### Description

포인트 만료 예정 조회 및 자동 만료 처리 시스템을 구현한다.

### Acceptance Criteria (완료 조건)

- [x] `GET /api/users/points/expiring` 엔드포인트로 30일 이내 만료 예정 포인트를 조회할 수 있다.
- [x] 매일 자정에 만료된 포인트가 자동으로 처리된다.
- [x] 만료 처리 시 EXPIRE 타입의 거래 내역이 생성된다.
- [x] 포인트는 적립일로부터 1년 후 만료된다.
- [x] 단위 테스트(Unit) 완료
- [x] 프론트 연동(동작) 테스트 준비
- [x] SonarCube(cloud) 테스트 통과

### 구현을 위한 기술 Task (To-Do)

- [x] 포인트 만료일 관리 로직 구현
- [x] 만료 예정 포인트 조회 로직 구현
- [x] 자동 만료 처리 스케줄러 구현 (PointScheduler)
- [x] 만료 처리 로직 구현 (processExpiredPoints)
- [x] 스케줄러 설정 및 스레드 풀 구성

---

## 🎯 MYCE-236: 포인트 취소 기능

### User Story

**As a** 쇼핑몰 사용자  
**I want to** 주문 취소 시 사용한 포인트를 다시 받을 수 있도록  
**So that** 주문 취소로 인한 포인트 손실을 방지할 수 있다.

### Description

주문 취소 시 포인트 환불 기능을 구현한다.

### Acceptance Criteria (완료 조건)

- [x] 주문 취소 시 사용된 포인트가 자동으로 환불된다.
- [x] 환불된 포인트는 원래 만료일을 유지한다.
- [x] 포인트 환불 시 CANCEL 타입의 거래 내역이 생성된다.
- [x] 환불된 포인트는 즉시 사용 가능하다.
- [x] 단위 테스트(Unit) 완료
- [x] 프론트 연동(동작) 테스트 준비
- [x] SonarCube(cloud) 테스트 통과

### 구현을 위한 기술 Task (To-Do)

- [x] 포인트 취소 로직 구현 (cancelPoints)
- [x] 주문 취소 시 포인트 환불 연동
- [x] 포인트 환불 시 만료일 복원 로직
- [x] 취소 거래 내역 생성 로직

---

## 🎯 MYCE-237: 포인트 통계 및 관리 기능

### User Story

**As a** 포인트 시스템 관리자  
**I want to** 포인트 시스템의 통계 정보를 조회하고 관리할 수 있도록  
**So that** 포인트 정책을 효과적으로 운영하고 분석할 수 있다.

### Description

포인트 시스템의 통계 정보 조회 및 관리 기능을 구현한다.

### Acceptance Criteria (완료 조건)

- [x] 사용자별 포인트 통계 정보를 조회할 수 있다.
- [x] 총 적립/사용/만료 포인트 통계가 제공된다.
- [x] 포인트 거래 내역의 상세 정보를 조회할 수 있다.
- [x] 포인트 시스템 운영에 필요한 로그가 기록된다.
- [x] 단위 테스트(Unit) 완료
- [x] 프론트 연동(동작) 테스트 준비
- [x] SonarCube(cloud) 테스트 통과

### 구현을 위한 기술 Task (To-Do)

- [x] 포인트 통계 집계 쿼리 구현
- [x] 포인트 거래 내역 상세 조회 로직
- [x] 포인트 시스템 로깅 구현
- [x] 통계 정보 API 구현

---

## 📊 구현 현황

### 완료된 기능 ✅

- [x] MYCE-232: 포인트 잔액 및 거래 내역 조회 기능
- [x] MYCE-233: 포인트 적립 및 사용 기능
- [x] MYCE-234: 포인트 거래 내역 상세 조회 기능
- [x] MYCE-235: 포인트 만료 관리 시스템
- [x] MYCE-236: 포인트 취소 기능
- [x] MYCE-237: 포인트 통계 및 관리 기능

### 향후 구현 예정 기능 🚧

- [ ] MYCE-238: 관리자 포인트 발급 기능
- [ ] MYCE-239: 이벤트 참여 보상 포인트
- [ ] MYCE-240: 리뷰 작성 보상 포인트
- [ ] MYCE-241: 생일 축하 포인트
- [ ] MYCE-242: 첫 구매 보너스 포인트
- [ ] MYCE-243: 만료 예정 포인트 알림 기능

---

## 🔗 관련 문서

- [포인트 시스템 상세 문서](./point_management.md)
- [API 문서](./api_documentation.md)
- [테스트 케이스](./test_cases.md)
